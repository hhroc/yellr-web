/*!
 * yellr-web v0.0.1 (http://yellr.net)
 * Copyright 2014-2015 hhroc
 * Licensed under MIT (https://github.com/hhroc/yellr-web/blob/master/LICENSE)
 */

!function(a,b,c){"use strict";b.yellr={tag:"Y E L L R",forms:{},modules:{},UUID:0,BASE_URL:"https://yellr.net/",URLS:{},SETTINGS:{lat:47,lng:40,language:{code:"en"}},init:function(){for(var b in this.modules)this.modules[b].init();a("#index").length&&(yellr.forms.form_1.init(),yellr.modules.server.get_assignments(function(b){yellr.utils.render_template({template:"#assignment-li-template",target:"#latest-assignments",context:{assignments:b}}),a("#latest-assignments").css("opacity",1),a("#latest-assignments + i").css("display","none"),a(c).foundation("reveal","reflow")}),yellr.modules.server.get_stories(function(b){yellr.utils.render_template({template:"#stories-li-template",target:"#latest-stories",context:{stories:b}}),a("#latest-stories").css("opacity",1),a("#latest-stories + i").css("display","none"),a(c).foundation("reveal","reflow")}),yellr.modules.server.get_local_posts(function(b){yellr.utils.render_template({template:"#latest-posts-li-template",target:"#latest-posts",context:{local_posts:b}}),a("#latest-posts").css("opacity",1),a("#latest-posts + i").css("display","none"),a(c).foundation("reveal","reflow")}))},utils:{feedback:function(a){alert(a)},render_template:function(b){if(!b.template||""===b.template)return void a(b.target).html("");var c=Handlebars.compile(a(b.template).html()),d=c(b.context?b.context:{});b.append?a(b.target).append(d):b.prepend?a(b.target).prepend(d):a(b.target).html(d)}}},a(c).ready(function(){a(c).foundation(),yellr.init()})}($,window,window.document),function(){"use strict";yellr.modules.user={tag:"user",init:function(){yellr.UUID=this.guid(),yellr.URLS.get_assignments=yellr.BASE_URL+"get_assignments.json?cuid="+yellr.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,yellr.URLS.get_stories=yellr.BASE_URL+"get_stories.json?cuid="+yellr.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,yellr.URLS.upload_media=yellr.BASE_URL+"upload_media.json?cuid="+yellr.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,yellr.URLS.publish_post=yellr.BASE_URL+"publish_post.json?cuid="+yellr.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,yellr.URLS.get_local_posts=yellr.BASE_URL+"get_local_posts.json?cuid="+yellr.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,yellr.URLS.server_info=yellr.BASE_URL+"server_info.json",console.log(this.tag,yellr.UUID)},guid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=d,f=[];if(b=b||e.length,a)for(c=0;a>c;c++)f[c]=e[0|Math.random()*b];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",c=0;36>c;c++)f[c]||(g=0|16*Math.random(),f[c]=e[19==c?3&g|8:g])}return f.join("")}}}($,window,window.document),function(a){"use strict";yellr.modules.server={tag:"server",init:function(){console.log(this.tag)},get_assignments:function(b){a.getJSON(yellr.URLS.get_assignments,function(a){a.success?b?b(a.assignments):console.log(a.assignments):console.log("lol - error in get_assignments")})},get_stories:function(b){a.getJSON(yellr.URLS.get_stories,function(a){a.success?b?b(a.stories):console.log(a.stories):console.log("lol - error in get_stories")})},get_local_posts:function(b){a.getJSON(yellr.URLS.get_local_posts,function(a){console.log(a),a.success?b?b(a.stories):console.log(a.stories):console.log("lol - error in get_local_posts")})},publish_post:function(b,c,d){var e=c||null;console.log(e),a.post(yellr.URLS.publish_post,{assignment_id:null,media_objects:JSON.stringify(b)},function(){yellr.modules.user.init()}).done(function(){d&&d()})}}}($,window,window.document),function(a){"use strict";yellr.forms.form_1={tag:"form 1",init:function(){function b(b){var c=Foundation.utils.random_str(6);yellr.utils.render_template({template:"#media-form-template",target:"#form-container",append:!0,context:{media_type:b,id_string:c}});var d=a(f.children()[f.length-1]),g=d.find("*[data-cancel]");g.on("click",function(){TweenMax.to(d,.3,{opacity:0,ease:Ease.easeIn,onComplete:function(){d.remove(),e.css("height",e.children().height())}})}),e.css("height",e.children().height())}var c=!1,d=a("#init-input"),e=a("#form-extras");d.on("focus",function(){e.css("height",e.children().height())}),d.on("keydown",function(){c===!1&&(d.off("blur"),c=!0)}),d.on("change",function(){""===d.val()&&(e.css("height",0),c=!1,d.on("blur",function(){e.css("height",0)}))});var f=a("#form-container");a("#report-form-1-submit").click(function(){var b=[],c=a("#form-container").children(),d=a("#homepage-intro-form"),e=1+c.length;d.ajaxSubmit({url:yellr.URLS.upload_media,clearForm:!0,dataType:"json",data:{description:a("#media_caption").val()},success:function(c){a("#media_caption").val(""),c.success&&(b.push(c.media_id),b.length===e?yellr.modules.server.publish_post([c.media_id],function(){}):(console.log("Something went wrong with upload_media..."),console.log(c)))}}),a.each(c,function(c,d){var f=a(d);console.log(f),f.ajaxSubmit({url:yellr.URLS.upload_media,clearForm:!0,success:function(a){a.success?(b.push(a.media_id),b.length===e&&yellr.modules.server.publish_post([a.media_id],function(){})):(console.log("Something went wrong with upload_media..."),console.log(a))}})})}),a("#add-photo-btn").click(function(){b("image")}),a("#add-video-btn").click(function(){yellr.utils.feedback("Feature coming soon!")}),a("#add-audio-btn").click(function(){yellr.utils.feedback("Feature coming soon!")})}}}($,window,window.document);