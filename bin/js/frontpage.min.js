/*!
 * yellr-web v0.0.1 (http://yellr.net)
 * Copyright 2014-2015 hhroc
 * Licensed under MIT (https://github.com/hhroc/yellr-web/blob/master/LICENSE)
 */

!function(a,b,c){"use strict";b.yellr={tag:"Y E L L R",modules:{},UUID:0,BASE_URL:"http://yellr.net/",URLS:{},SETTINGS:{lat:47,lng:40,language:{code:"en"}},init:function(){for(var b in this.modules)this.modules[b].init();this.UUID=this.utils.guid(),this.URLS.assignments=this.BASE_URL+"get_assignments.json?cuid="+this.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,this.URLS.stories=this.BASE_URL+"get_stories.json?cuid="+this.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,this.URLS.notifications=this.BASE_URL+"get_notifications.json?client_id="+this.UUID,this.URLS.messages=this.BASE_URL+"get_messages.json?client_id="+this.UUID,this.URLS.profile=this.BASE_URL+"todo",this.URLS.upload=this.BASE_URL+"upload_media.json?cuid="+this.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,this.URLS.post=this.BASE_URL+"publish_post.json?cuid="+this.UUID+"&language_code="+yellr.SETTINGS.language.code+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng,this.URLS.server_info=this.BASE_URL+"server_info.json",this.URLS.send_message=this.BASE_URL+"create_response_message.json",this.URLS.get_local_posts=this.BASE_URL+"get_local_posts.json?cuid="+this.UUID+"&lat="+yellr.SETTINGS.lat+"&lng="+yellr.SETTINGS.lng+"&language_code="+yellr.SETTINGS.language.code,a("#submit-tip").click(function(){yellr.modules.submit.submit_tip()}),a("#textarea").keydown(function(b){a("#display").text((b.metaKey||b.ctrlKey)&&13==b.keyCode)}),a("#index").length&&(yellr.modules.server.get_assignments(function(a){yellr.utils.render_template({template:"#assignment-li-template",target:"#latest-assignments",context:{assignments:a}})}),yellr.modules.server.get_stories(function(a){yellr.utils.render_template({template:"#stories-li-template",target:"#latest-stories",context:{stories:a}})}),yellr.modules.server.get_local_posts(function(a){yellr.utils.render_template({template:"#latest-posts-li-template",target:"#latest-posts",context:{local_posts:a}})}))},utils:{guid:function(a,b){var c,d="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=d,f=[];if(b=b||e.length,a)for(c=0;a>c;c++)f[c]=e[0|Math.random()*b];else{var g;for(f[8]=f[13]=f[18]=f[23]="-",f[14]="4",c=0;36>c;c++)f[c]||(g=0|16*Math.random(),f[c]=e[19==c?3&g|8:g])}return f.join("")},render_template:function(b){if(!b.template||""===b.template)return void a(b.target).html("");var c=Handlebars.compile(a(b.template).html()),d=c(b.context?b.context:{});b.append?a(b.target).append(d):b.prepend?a(b.target).prepend(d):a(b.target).html(d)}}},a(c).ready(function(){a(c).foundation(),yellr.init()})}($,window,window.document),function(a){"use strict";yellr.modules.submit={tag:"submit.js",init:function(){console.log(this.tag),this.$forms=a(".submit-form")},submit_tip:function(){console.log("get all the forms");var b=a(".form-container form"),c=[];console.log(b.length);for(var d=0;d<b.length;d++){var e=b[d];console.log(d,e),this.validate_form(e)&&a(e).ajaxSubmit({url:yellr.URLS.upload,data:{client_id:yellr.UUID},success:function(a){console.log(a),a.success?(c.push(a.media_id),c.length===b.length&&yellr.modules.submit.publish_post(c,function(){console.log("lol things?S")})):(console.log("Something went wrong with upload_media..."),console.log(a))},clearForm:!0})}},validate_form:function(b){var c=a(b),d=!1;return"text"===c.attr("data-media-type")?(console.log(c.find("textarea").val()),""!==c.find("textarea").val()?d=!0:alert("form is empty")):b.querySelector('input[name="media_file"]').value?d=!0:(alert("form is empty"),yellr.utils.notify("Missing media file.")),d},publish_post:function(b,c){a.post(yellr.URLS.post,{title:"Web Submission",client_id:yellr.UUID,assignment_id:null,language_code:yellr.SETTINGS.language.code,lat:yellr.SETTINGS.lat,lng:yellr.SETTINGS.lng,media_objects:JSON.stringify(b)},function(){console.log("post published"),yellr.UUID=yellr.utils.guid()}).done(function(){c&&c()})}}}($,window,window.document),function(a){"use strict";yellr.modules.server={tag:"server",init:function(){console.log(this.tag)},get_assignments:function(b){a.getJSON(yellr.URLS.assignments,function(a){a.success?b?b(a.assignments):console.log(a.assignments):console.log("lol - error in get_assignments")})},get_stories:function(b){a.getJSON(yellr.URLS.stories,function(a){a.success?b?b(a.stories):console.log(a.stories):console.log("lol - error in get_stories")})},get_local_posts:function(){a.getJSON(yellr.URLS.get_local_posts,function(a){console.log(a)})}}}($,window,window.document);